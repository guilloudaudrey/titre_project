

{% extends 'layout.html.twig' %}

{% block content %}

        <div class="container container_full_page" style="padding-bottom:60px">
            <div class="user_question">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12 avatar_pseudo_container">
                        <div class="avatar_post_author" style="background-image:url('{{asset('/avatars/'~post.user.getAvatarFilename()) }}')"></div>
                        <div class="avatar_pseudo">{{ post.user }}</div>
                    </div>


                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
                        <div class="panel panel-info">
                            <div class="panel-body">
                                <p>{{ post.text }}</p>
                                <div style="display: flex" class="pull-right">
                                    {% if postResponses|length < 1 %}
                                        <a  style="margin-right: 5px" class="btn btn-default btn-sm" href="{{ path('post_edit', { 'id': post.id }) }}">Modifier</a>
                                        <!-- Trigger the modal with a button -->
                                        <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#myModal">Supprimer</button>
                                        {% include 'post/modal_delete_post.html.twig' %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="panel-footer panel-footer-question">
                                <div >Posté le {{ post.createdAt|date('y-m-d à H:i') }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1 col-md-1 col-sm-1 col-xs-12 post_eval_container">
                        {% if post.getScore() > 0 %}
                            <span class="label label-warning label_eval_post">
                                {{ post.getScore() }}
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% if post.status != 'closed' and post.status != 'noErrors' %}
                {% if app.user != post.user %}
                    {% if postResponseByUser is empty %}
                        <div class="container_button_no_errors">
                            <a class="btn btn-default " href="{{ path('post_up', {id : post.id}) }}"><span class="glyphicon glyphicon-eye-open"></span> Il n'y a pas d'erreurs</a>
                        </div>
                        <div class="container_button_create_post">
                        <a class="btn btn-info " href="{{ path('postresponse_new', {id : post.id}) }}"><span class="glyphicon glyphicon-pencil"></span> Poster une nouvelle réponse</a>
                        </div>
                    {% else %}
                        <div class="alert alert-warning alert_answer_already" role="alert">Vous avez répondu à cette demande.</div>
                    {% endif %}
                {% endif %}
            {% else %}
                {% if post.status == "closed" %}
                    <div class="alert alert-success alert_closed" role="alert">Une solution a été apportée !</div>
                {% elseif post.status == "noErrors" %}
                    <div class="alert alert-success alert_no_errors" role="alert">Aucune erreur n'a été relevée !</div>
                {% endif %}
            {% endif %}

        <h2>{{ postResponses|length }} {% if postResponses|length > 1 %}réponses {% else %}réponse {% endif %}</h2>
        <hr class="my-4">

            {% for postResponse in postResponses %}
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 row_post_response">
                    <div class="col-md-1 col-sm-1 col-xs-2">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            {% if postResponse.score >= 3 %}
                                <span class="glyphicon glyphicon-ok" ></span>
                            {% endif %}
                        </div>
                        <div class="col-md-12 col-sm-12 col-xs-12 vote_buttons">
                            {% if post.status != "closed" and post.status != "noErrors" %}
                                <div class=" voteup">
                                    {% if app.user != post.user and app.user != postResponse.user %}
                                        <a href="{{ url('postresponse_up',{id: postResponse.id }) }}"><span id="plus{{ postResponse.getId() }}" class="glyphicon glyphicon-plus blue-none"></span></a>
                                    {% endif %}
                                </div>
                            {% endif %}
                                <span class="label label-info">
                                    {{ postResponse.score }}
                                </span>
                            {% if post.status != "closed" and post.status != "noErrors" %}
                                <div class=" votedown">
                                    {% if app.user != post.user and app.user != postResponse.user %}
                                        <a href="{{ url('postresponse_down',{id: postResponse.id }) }}"><span id="minus{{ postResponse.getId() }}" class="glyphicon glyphicon-minus"></span></a>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="col-md-10 col-sm-10 col-xs-10">
                        <div class="panel panel-default card_answer">
                            {% include 'postresponse/prototype-post-response-show.html.twig' with {postResponse: postResponse} only %}
                        </div>
                    </div>
                    <div class="col-md-1 col-sm-1 hidden-xs ">
                        <div class="avatar_post_response_author" style="background-image:url('{{asset('/avatars/'~postResponse.user.getAvatarFilename()) }}')"></div>
                    </div>
                </div>
            {% endfor %}
    </div>

    <script>
        {% for postResponse in postResponses %}
            {% for evaluation in app.user.getEvaluations() %}
                {% if evaluation.getValue == 1 %}
                    {% if evaluation.getPostResponse().getId() == postResponse.getId() %}
                        $(document).ready(function() {
                                $('#plus{{ postResponse.getId }}').css('cssText', 'color: lightblue !important');
                        })

                    {% endif %}
                {% else %}
                    {% if evaluation.getPostResponse().getId() == postResponse.getId() %}
                    $(document).ready(function() {
                        $('#minus{{ postResponse.getId }}').css('cssText', 'color: lightblue !important');
                    })

                    {% endif %}
                {% endif %}
            {% endfor %}
        {% endfor %}
    </script>


{% endblock %}


